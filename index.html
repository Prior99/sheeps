<html>
	<head>
		
		<script type="text/javascript" src="sheep.js"></script>
		<script type="text/javascript" src="cursor.js"></script>
		<script type="text/javascript" src="vector.js"></script>
		<script type="text/javascript" src="target.js"></script>
		<script type="text/javascript" src="hole.js"></script>
		<script type="text/javascript" src="wolf.js"></script>
		<script type="text/javascript" src="wall.js"></script>
		<script type="text/javascript" src="moveablewall.js"></script>
	</head>
	<body>
		<canvas id="canvas" width="800" height="600"></canvas>
		<script>
			var FPS = 30;
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			var sheep = new Sheep(400, 300);
			var sheeps = [];
			var wolfes = [];
			var holes = [];
			var walls = [];
			var targets = [];
			var cursor = new Cursor(canvas);
			targets.push(new Target(130, 450, 50, 20, true));
			targets.push(new Target(130, 150, 50, 20, true));
			holes.push(new Hole(400, 300, 30));
			wolfes.push(new Wolf(790, 20));
			wolfes.push(new Wolf(790, 300));
			wolfes.push(new Wolf(790, 580));
			/*walls.push(new Wall(240, 100, 50, 400));
			walls.push(new Wall(540, 200, 50, 200));*/
			for(var x = 200; x <= 540; x+= 80)
				walls.push(new MoveableWall(x, 100, x, 300, 20, 200));
			for(var x = 240; x <= 540; x+= 80)
				walls.push(new MoveableWall(x, 300, x, 100, 20, 200));
			var bound = {
				min : new vec(10, 10), 
				max : new vec(canvas.width - 10, canvas.height - 10)
			};
			for(var i = 0; i < 100; i++) {
				var index = (i / 100) * (Math.PI * 2);
				if(i > 10 && i < 90) {
					sheeps.push(new Sheep(400 + Math.sin(index)*80, 300 - Math.cos(index)*80));
				}
			}
			var drawInterval = setInterval(function() {
				ctx.fillStyle = "rgb(140, 140, 255)";
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				for(var key in targets) {
					targets[key].draw(ctx);
				}
				for(var key in wolfes) {
					wolfes[key].draw(ctx);
				}
				for(var key in holes) {
					holes[key].draw(ctx);
				}
				for(var key in sheeps) {
					sheeps[key].draw(ctx);
				}
				for(var key in walls) {
					walls[key].draw(ctx);
				}
				cursor.draw(ctx);
			}, 100/FPS);
			var tickInterval = setInterval(function() {
				for(var key in sheeps) {
					sheeps[key].tick(cursor, walls);
				}
				for(var key in walls) {
					walls[key].tick();
				}
				for(var key in wolfes) {
					if(wolfes[key].tick(sheeps, cursor, walls)) {
						lost();
					}
				}
				for(var key in holes) {
					if(holes[key].tick(sheeps)) {
						lost();
					}
				}
				var won = true;
				for(var key in targets) {
					if(!targets[key].tick(sheeps)) {
						won = false;
					}
				}
				if(won) {
					win();
				}
			}, 100/FPS);
			
			function lost() {
				stop("VERLOREN!");
			}
			
			function win() {
				stop("GEWONNEN!");	
			}
			
			function stop(string) {
				clearInterval(drawInterval);
				clearInterval(tickInterval);
				ctx.fillStyle = "white";
				ctx.font = "bold 25px Arial";
				ctx.fillText(string, 100, 300);
			}
		</script>
	</body>
</html>
