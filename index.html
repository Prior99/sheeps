<html>
	<head>
		<script src="sheeps.min.js"></script>
		<script src="jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>
	<body>
		<h1>Levels</h1>
		<div class="wrapper">
			<div class="list" id="list">
			</div>
		</div>
		<script>
			function checkDependencies(arr) {
				for(var i = 0; i < arr.length; i++) {
					var item = localStorage.getItem(arr[i]);
					if(item === undefined || item == false || item == null) {
						return false;
					} 
				}
				return true;
			}
			
			var FPS = 30;
			var list = $("#list");
			$.ajax({
				url : "levels/descriptor.json",
				dataType : "json"
			}).done(function(data) {
				console.log(data);
				for(var i = 0; i < data.length; i++) {
					(function(obj) {
						var elem = $("<div class='container'></div>")
							.append($("<div class='content'></div>")
								.append($("<img width='80' height='80' src='" + obj.image + "' />"))
								.append($("<h1>" + obj.name + "</h1>"))
								.append($("<p>" + obj.description + "</p>"))
							);
						if(obj.dependencies === undefined || checkDependencies(obj.dependencies)) {
							elem.addClass("unlocked");
							elem.click(function() {
								startLevel(obj.file, obj.name);
							});
						}
						else {
							elem.addClass("locked");
						}
						elem.appendTo(list);
					})(data[i]);
				}
			});
			
			function startLevel(url, name) {
				$("body").html("");
				var canvas = $('<canvas id="canvas" width="800" height="600"></canvas>').appendTo("body")[0];
				$.ajax({
					url : url,
					dataType : "text"
				}).done(function(text) {
					var f = eval("(" + text + ")");
					f();
					Game.init(canvas, FPS, name);
				}).error(function(obj, err1, err2) {
					console.log(err1, err2);
				});
			}
		</script>
	</body>
</html>
